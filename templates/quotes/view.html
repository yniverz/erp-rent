{% extends "base.html" %}

{% block title %}Quote #{{ quote.id }} - ERP Rent{% endblock %}

{% block content %}
<h1>Quote #{{ quote.id }}</h1>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-label">Customer</div>
        <div class="stat-value">{{ quote.customer_name }}</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">Rental Days</div>
        <div class="stat-value">{{ quote.rental_days }}</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">Total</div>
        <div class="stat-value">{{ "%.2f"|format(quote.total) }}€</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">Status</div>
        <div class="stat-value">
            {% if quote.status == 'draft' %}
                <span class="badge badge-draft">Draft</span>
            {% elif quote.status == 'finalized' %}
                <span class="badge badge-finalized">Finalized</span>
            {% elif quote.status == 'paid' %}
                <span class="badge badge-paid">Paid</span>
            {% endif %}
        </div>
    </div>
</div>

{% if quote.notes %}
<div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 20px 0;">
    <strong>Notes:</strong><br>
    {{ quote.notes }}
</div>
{% endif %}

<h2>Items</h2>

<table>
    <thead>
        <tr>
            <th>Item</th>
            <th>Quantity</th>
            <th>Price/Day</th>
            <th>Days</th>
            <th>Subtotal</th>
        </tr>
    </thead>
    <tbody>
        {% for qi in quote.quote_items %}
        <tr>
            <td>{{ qi.display_name }}{% if qi.is_custom %} <em>(Custom)</em>{% endif %}</td>
            <td>{{ qi.quantity }}</td>
            <td>{{ "%.2f"|format(qi.rental_price_per_day) }}€</td>
            <td>{{ quote.rental_days }}</td>
            <td>{{ "%.2f"|format(qi.total_price) }}€</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div class="price-summary">
    <div class="price-row">
        <span>Subtotal:</span>
        <span>{{ "%.2f"|format(quote.subtotal) }}€</span>
    </div>
    
    {% if quote.discount_percent > 0 %}
    <div class="price-row">
        <span>Discount ({{ quote.discount_percent }}%):</span>
        <span>-{{ "%.2f"|format(quote.discount_amount) }}€</span>
    </div>
    {% endif %}
    
    <div class="price-row total">
        <span>Total:</span>
        <span>{{ "%.2f"|format(quote.total) }}€</span>
    </div>
</div>

<div style="margin-top: 20px;" class="no-print">
    <a href="{{ url_for('quote_list') }}" class="btn">Back to Quotes</a>
    <a href="{{ url_for('quote_receipt', quote_id=quote.id) }}" class="btn btn-primary" target="_blank">View Receipt</a>
    <a href="{{ url_for('quote_german_doc', quote_id=quote.id) }}" class="btn btn-primary" target="_blank">German Document</a>
    
    {% if quote.status == 'finalized' %}
        <form method="POST" action="{{ url_for('quote_mark_paid', quote_id=quote.id) }}" style="display: inline;">
            <button type="submit" class="btn btn-success">Mark as Paid</button>
        </form>
        <form method="POST" action="{{ url_for('quote_unfinalize', quote_id=quote.id) }}" style="display: inline;">
            <button type="submit" class="btn" onclick="return confirm('Are you sure you want to return this quote to draft status?')">Undo Finalization</button>
        </form>
    {% endif %}
    
    {% if quote.status == 'draft' %}
        <a href="{{ url_for('quote_edit', quote_id=quote.id) }}" class="btn btn-primary">Continue Editing</a>
    {% endif %}
</div>

<div style="margin-top: 20px; font-size: 0.9em; color: #666;">
    <p>Created: {{ quote.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
    {% if quote.finalized_at %}
    <p>Finalized: {{ quote.finalized_at.strftime('%Y-%m-%d %H:%M') }}</p>
    {% endif %}
    {% if quote.paid_at %}
    <p>Paid: {{ quote.paid_at.strftime('%Y-%m-%d %H:%M') }}</p>
    {% endif %}
</div>

{% endblock %}

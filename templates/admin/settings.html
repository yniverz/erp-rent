{% extends "admin/base.html" %}

{% block title %}Einstellungen - Verwaltung{% endblock %}

{% block content %}
<h1>Seiteneinstellungen</h1>

<div class="card">
    <form method="POST" enctype="multipart/form-data">
        <h2>Unternehmensinformationen</h2>
        <p class="text-muted mb-16">Wird in PDFs und der öffentlichen Storefront verwendet.</p>

        <div class="form-group">
            <label>Firmenname</label>
            <input type="text" name="business_name" value="{{ settings.business_name or '' }}">
        </div>

        <div class="form-group">
            <label>Adresszeilen</label>
            <textarea name="address_lines" rows="3" placeholder="Straße&#10;PLZ Stadt&#10;Land">{{ settings.address_lines or '' }}</textarea>
        </div>

        <div class="form-group">
            <label>Kontaktdaten</label>
            <textarea name="contact_lines" rows="3" placeholder="Tel: +49 ...&#10;Email: info@...">{{ settings.contact_lines or '' }}</textarea>
        </div>

        <div class="form-group">
            <label>Bankverbindung</label>
            <textarea name="bank_lines" rows="3" placeholder="Bank: ...&#10;IBAN: ...&#10;BIC: ...">{{ settings.bank_lines or '' }}</textarea>
        </div>

        <div class="form-group">
            <label>Steuernummer / USt-IdNr</label>
            <input type="text" name="tax_number" value="{{ settings.tax_number or '' }}" placeholder="DE123456789 oder 12/345/67890">
        </div>

        <div class="form-group">
            <label>Umsatzsteuer-Modus</label>
            <select name="tax_mode">
                <option value="kleinunternehmer" {{ 'selected' if (settings.tax_mode or 'kleinunternehmer') == 'kleinunternehmer' }}>Kleinunternehmer (&sect;19 UStG) &ndash; keine MwSt</option>
                <option value="regular" {{ 'selected' if settings.tax_mode == 'regular' }}>Regul&auml;r &ndash; 19% MwSt ausweisen</option>
            </select>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Zahlungsziel (Tage)</label>
                <input type="number" name="payment_terms_days" value="{{ settings.payment_terms_days or 14 }}" min="1" max="365">
            </div>
            <div class="form-group">
                <label>Angebots-G&uuml;ltigkeit (Tage)</label>
                <input type="number" name="quote_validity_days" value="{{ settings.quote_validity_days or 14 }}" min="1" max="365">
            </div>
        </div>

        <div class="form-group">
            <label>Firmenlogo</label>
            {% if settings.logo_filename %}
                <div class="mb-8">
                    <img src="{{ url_for('admin.serve_logo') }}" alt="Logo" style="max-height: 80px; max-width: 300px;">
                    <br>
                    <small class="text-muted">Aktuell: {{ settings.logo_filename }}</small>
                </div>
            {% endif %}
            <input type="file" name="logo" accept="image/png,image/jpeg,image/svg+xml,image/webp,image/gif">
            <small class="help-text">PNG, JPEG, SVG, WebP oder GIF. Wird auf PDFs oben rechts angezeigt.</small>
            {% if settings.logo_filename %}
                <label class="mt-4" style="font-weight:normal;"><input type="checkbox" name="remove_logo" value="1"> Logo entfernen</label>
            {% endif %}
        </div>

        <hr class="section-divider">

        <h2>Öffentlicher Shop</h2>

        <div class="form-group">
            <label>Shop-Beschreibung</label>
            <textarea name="shop_description" rows="2" placeholder="Kurze Beschreibung für die Storefront...">{{ settings.shop_description or '' }}</textarea>
        </div>

        <hr class="section-divider">

        <h2>Rechtliche Links</h2>
        <p class="text-muted mb-16">Diese werden im Footer der öffentlichen Storefront angezeigt.</p>

        <div class="form-row">
            <div class="form-group">
                <label>Impressum-URL</label>
                <input type="url" name="imprint_url" value="{{ settings.imprint_url or '' }}" placeholder="https://...">
            </div>
            <div class="form-group">
                <label>Datenschutz-URL</label>
                <input type="url" name="privacy_url" value="{{ settings.privacy_url or '' }}" placeholder="https://...">
            </div>
        </div>

        <hr class="section-divider">

        <h2>Allgemeine Geschäftsbedingungen (AGB)</h2>
        <p class="text-muted mb-16">Werden dem Angebot als Anlage angehängt. Einfaches Markdown: <code>#</code> für Überschriften, <code>##</code> für Unterüberschriften, Leerzeile für Absätze.</p>

        <div class="form-group">
            <label>AGB-Text</label>
            <textarea name="terms_and_conditions_text" rows="12" placeholder="# Allgemeine Geschäftsbedingungen&#10;&#10;## §1 Geltungsbereich&#10;Diese AGB gelten für...">{{ settings.terms_and_conditions_text or '' }}</textarea>
        </div>

        <hr class="section-divider">

        <h2>Benachrichtigungen</h2>

        <div class="form-group">
            <label>Benachrichtigungs-E-Mail</label>
            <input type="email" name="notification_email" value="{{ settings.notification_email or '' }}" placeholder="Empfängt Anfrage-Benachrichtigungen">
            <small class="help-text">E-Mail-Adresse, die Benachrichtigungen erhält, wenn Kunden Anfragen absenden. SMTP muss über Umgebungsvariablen konfiguriert sein (SMTP_SERVER, SMTP_PORT, SMTP_USER, SMTP_PASSWORD).</small>
        </div>

        <button type="submit" class="btn btn-primary mt-10">Einstellungen speichern</button>
    </form>
</div>
{% endblock %}

{% extends "admin/base.html" %}

{% block title %}{{ 'Benutzer bearbeiten' if user else 'Benutzer hinzufügen' }} - Verwaltung{% endblock %}

{% block content %}
<h1>{{ 'Benutzer bearbeiten: ' + user.username if user else 'Neuen Benutzer hinzufügen' }}</h1>

<div class="card">
    <form method="POST">
        {% if not user %}
        <div class="form-group">
            <label>Benutzername *</label>
            <input type="text" name="username" required>
        </div>
        {% endif %}

        <div class="form-group">
            <label>{{ 'Neues Passwort (leer lassen, um aktuelles beizubehalten)' if user else 'Passwort *' }}</label>
            <input type="password" name="password" {{ '' if user else 'required' }}>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Anzeigename</label>
                <input type="text" name="display_name" value="{{ user.display_name if user else '' }}">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" name="email" value="{{ user.email if user else '' }}">
            </div>
        </div>

        <div class="form-group">
            <div class="checkbox-group">
                <input type="checkbox" name="is_external_user" id="is_external_user" {{ 'checked' if user and user.is_external_user }} onchange="toggleExternalUser()">
                <label for="is_external_user" class="m-0 font-normal">Externer Benutzer</label>
            </div>
            <small class="help-text">Externe Benutzer können sich nicht anmelden. Alle Artikelzuordnungen erfordern einen externen Preis.</small>
        </div>

        <div id="internal-user-options">
        <div class="form-group">
            <div class="checkbox-group">
                <input type="checkbox" name="is_admin" id="is_admin" {{ 'checked' if user and user.is_admin }}>
                <label for="is_admin" class="m-0 font-normal">Admin</label>
            </div>
            <small class="help-text">Admins können Benutzer, Einstellungen und alle Artikel verwalten.</small>
        </div>

        <div class="form-group">
            <div class="checkbox-group">
                <input type="checkbox" name="can_edit_all" id="can_edit_all" {{ 'checked' if user and user.can_edit_all }}>
                <label for="can_edit_all" class="m-0 font-normal">Kann alle Artikel bearbeiten</label>
            </div>
            <small class="help-text">Erlaubt das Bearbeiten von Artikeln anderer Benutzer (ohne volle Admin-Rechte).</small>
        </div>
        </div>

        {% if user %}
        <div class="form-group">
            <div class="checkbox-group">
                <input type="checkbox" name="active" id="active" {{ 'checked' if user.active }}>
                <label for="active" class="m-0 font-normal">Konto aktiv</label>
            </div>
            <small class="help-text">Inaktive Konten können sich nicht anmelden.</small>
        </div>
        {% endif %}

        <div class="d-flex gap-10 mt-24">
            <button type="submit" class="btn btn-primary">{{ 'Benutzer aktualisieren' if user else 'Benutzer erstellen' }}</button>
            <a href="{{ url_for('admin.user_list') }}" class="btn btn-outline">Abbrechen</a>
        </div>
    </form>
</div>

<script>
function toggleExternalUser() {
    var isExternal = document.getElementById('is_external_user').checked;
    document.getElementById('internal-user-options').style.display = isExternal ? 'none' : '';
    if (isExternal) {
        document.getElementById('is_admin').checked = false;
        document.getElementById('can_edit_all').checked = false;
    }
}
toggleExternalUser();
</script>
{% endblock %}
